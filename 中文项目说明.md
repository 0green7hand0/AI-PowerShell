# 🤖 AI PowerShell 智能助手

一个基于本地 AI 模型的智能 PowerShell 命令行助手，支持中文自然语言交互。

## 🌟 项目特色

### 🇨🇳 中文支持
- **中文自然语言理解**: 支持中文描述转换为 PowerShell 命令
- **中文文档和注释**: 完整的中文文档和代码注释
- **中文错误提示**: 友好的中文错误信息和建议

### 🔒 安全第一
- **三层安全保护**: 命令白名单 + 权限检查 + 沙箱执行
- **智能风险评估**: 自动识别危险命令并阻止执行
- **完整审计日志**: 记录所有操作，支持追溯和分析

### 🤖 本地 AI 处理
- **隐私保护**: 所有 AI 处理在本地进行，不上传数据
- **多模型支持**: 支持 LLaMA、Ollama 等多种本地 AI 模型
- **智能学习**: 根据使用历史优化命令生成

### 🌐 跨平台兼容
- **Windows**: 支持 PowerShell 5.1 和 PowerShell Core
- **Linux**: 完整支持 PowerShell Core
- **macOS**: 原生支持 PowerShell Core

## 🚀 快速体验

### 1. 一键安装
```bash
# Linux/macOS 自动安装
curl -fsSL https://raw.githubusercontent.com/0green7hand0/AI-PowerShell/main/scripts/install.sh | bash

# Windows PowerShell 安装
Invoke-WebRequest -Uri "https://raw.githubusercontent.com/0green7hand0/AI-PowerShell/main/scripts/install.ps1" -OutFile "install.ps1"
.\install.ps1
```

### 2. 启动助手
```bash
# 运行主程序
python src/main.py

# 或使用交互模式
python src/main.py --interactive
```

### 3. 中文交互示例
```python
# 导入主控制器
from src.main import PowerShellAssistant

# 创建助手实例
助手 = PowerShellAssistant()

# 处理中文请求
结果 = 助手.process_request("显示CPU使用率最高的5个进程")

# 查看结果
print(结果.output)
```

## 📖 中文使用示例

### 系统管理
```python
from src.main import PowerShellAssistant

助手 = PowerShellAssistant()

# 中文描述，自动转换为 PowerShell 命令
助手.process_request("显示内存使用超过500MB的进程")
助手.process_request("检查磁盘空间使用情况") 
助手.process_request("列出所有正在运行的服务")
助手.process_request("查看系统启动时间")
```

### 文件操作
```python
# 文件管理任务
助手.process_request("列出当前目录下的所有.txt文件")
助手.process_request("创建一个名为'备份'的文件夹")
助手.process_request("查找大于100MB的文件")
助手.process_request("显示文件夹权限设置")
```

### 网络诊断
```python
# 网络相关任务
助手.process_request("测试到百度的网络连接")
助手.process_request("显示本机所有IP地址")
助手.process_request("查看网络适配器状态")
助手.process_request("显示当前网络连接")
```

### 交互模式
```bash
# 启动交互模式
python src/main.py --interactive

# 在交互模式中直接输入中文
> 显示CPU使用率最高的5个进程
🤖 翻译: Get-Process | Sort-Object CPU -Descending | Select-Object -First 5
🔒 安全检查: ✅ 通过
🤔 是否执行此命令? (y/N): y
✅ 执行成功
📄 输出: [进程列表]
```

## 🏗️ 系统架构

### 模块化架构设计

项目采用高内聚低耦合的模块化架构，清晰分离各个功能模块：

```
┌─────────────────────────────────────────────────────────────┐
│                    用户接口层 (User Interface)                │
│  ┌─────────────┬─────────────┬─────────────────────────────┐ │
│  │ 命令行界面   │  交互模式    │  API 接口                    │ │
│  │   (CLI)     │ (Interactive)│  (API)                      │ │
│  └─────────────┴─────────────┴─────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│                  核心处理层 (Core Processing)                 │
│  ┌──────────────────────────────────────────────────────┐   │
│  │           PowerShellAssistant (主控制器)              │   │
│  │  - 协调各组件工作                                      │   │
│  │  - 管理请求处理流程                                    │   │
│  │  - 提供统一的接口                                      │   │
│  └──────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
                            │
        ┌───────────────────┼───────────────────┐
        ▼                   ▼                   ▼
┌──────────────┐   ┌──────────────┐   ┌──────────────┐
│  AI 引擎      │   │  安全引擎     │   │  执行引擎     │
│ (AI Engine)  │   │(Security Eng.)│   │(Exec Engine) │
└──────────────┘   └──────────────┘   └──────────────┘
        │                   │                   │
        └───────────────────┼───────────────────┘
                            ▼
┌─────────────────────────────────────────────────────────────┐
│                   支持模块层 (Support Modules)                │
│  ┌─────────────┬─────────────┬─────────────┬─────────────┐   │
│  │  配置管理    │  日志引擎    │  存储引擎    │  上下文管理  │   │
│  │  (Config)   │  (Logging)  │  (Storage)  │  (Context)  │   │
│  └─────────────┴─────────────┴─────────────┴─────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

## 🔧 核心组件详解

### 🤖 AI 引擎 (AI Engine)
- **位置**: `src/ai_engine/`
- **功能**: 中文自然语言到 PowerShell 命令转换
- **组件**:
  - `engine.py`: AI 引擎主类，协调翻译流程
  - `translation.py`: 翻译逻辑和规则匹配
  - `providers.py`: AI 提供商（LLaMA、Ollama 等）
  - `error_detection.py`: 错误检测和修正
- **特点**: 本地处理，支持多种 AI 模型，规则匹配和 AI 结合

### 🔒 安全引擎 (Security Engine)  
- **位置**: `src/security/`
- **功能**: 三层安全验证和沙箱执行
- **组件**:
  - `engine.py`: 安全引擎主类，协调三层验证
  - `whitelist.py`: 命令白名单验证
  - `permissions.py`: 权限检查和确认
  - `sandbox.py`: Docker 沙箱执行
- **特点**: 智能风险评估，可配置安全规则，完整审计日志

### ⚡ 执行引擎 (Execution Engine)
- **位置**: `src/execution/`
- **功能**: 跨平台 PowerShell 命令执行
- **组件**:
  - `executor.py`: 执行器主类
  - `platform_adapter.py`: 平台适配器
  - `output_formatter.py`: 输出格式化
- **特点**: 自动平台检测，中文编码支持，超时控制

### 📊 日志引擎 (Logging Engine)
- **位置**: `src/log_engine/`
- **功能**: 全面的审计跟踪和性能监控
- **组件**:
  - `engine.py`: 日志引擎主类
  - `decorators.py`: 日志装饰器
  - `filters.py`: 日志过滤器
- **特点**: 结构化日志，关联追踪，敏感信息过滤

### 💾 存储引擎 (Storage Engine)
- **位置**: `src/storage/`
- **功能**: 配置管理和数据持久化
- **组件**:
  - `interfaces.py`: 存储接口定义
  - `file_storage.py`: 文件存储实现
  - `factory.py`: 存储工厂
- **特点**: 支持多种存储后端，自动备份，版本控制

### 🧠 上下文管理 (Context Manager)
- **位置**: `src/context/`
- **功能**: 会话管理和历史记录
- **组件**:
  - `manager.py`: 上下文管理器
  - `history.py`: 历史记录管理
  - `models.py`: 上下文数据模型
- **特点**: 智能上下文维护，会话追踪，命令历史

### ⚙️ 配置管理 (Configuration Management)
- **位置**: `src/config/`
- **功能**: 系统配置和验证
- **组件**:
  - `manager.py`: 配置管理器
  - `models.py`: 配置数据模型（使用 Pydantic）
- **特点**: YAML 配置文件，数据验证，默认值支持

## 📚 项目结构

```
AI-PowerShell/
├── src/                   # 源代码目录（模块化架构）
│   ├── interfaces/        # 接口定义层
│   │   └── base.py       # 基础接口和数据模型
│   ├── ai_engine/         # AI 引擎模块
│   │   ├── engine.py     # AI 引擎主类
│   │   ├── translation.py # 翻译逻辑
│   │   ├── providers.py  # AI 提供商
│   │   └── error_detection.py # 错误检测
│   ├── security/          # 安全引擎模块
│   │   ├── engine.py     # 安全引擎主类
│   │   ├── whitelist.py  # 命令白名单
│   │   ├── permissions.py # 权限检查
│   │   └── sandbox.py    # 沙箱执行
│   ├── execution/         # 执行引擎模块
│   │   ├── executor.py   # 执行器主类
│   │   ├── platform_adapter.py # 平台适配
│   │   └── output_formatter.py # 输出格式化
│   ├── config/            # 配置管理模块
│   │   ├── manager.py    # 配置管理器
│   │   └── models.py     # 配置数据模型
│   ├── log_engine/        # 日志引擎模块
│   │   ├── engine.py     # 日志引擎主类
│   │   ├── decorators.py # 日志装饰器
│   │   └── filters.py    # 日志过滤器
│   ├── storage/           # 存储引擎模块
│   │   ├── interfaces.py # 存储接口
│   │   ├── file_storage.py # 文件存储
│   │   └── factory.py    # 存储工厂
│   ├── context/           # 上下文管理模块
│   │   ├── manager.py    # 上下文管理器
│   │   ├── history.py    # 历史记录
│   │   └── models.py     # 上下文数据模型
│   └── main.py            # 主入口文件
├── tests/                 # 测试目录
│   ├── ai_engine/         # AI 引擎测试
│   ├── security/          # 安全引擎测试
│   ├── execution/         # 执行引擎测试
│   ├── config/            # 配置管理测试
│   ├── log_engine/        # 日志引擎测试
│   ├── storage/           # 存储引擎测试
│   ├── context/           # 上下文管理测试
│   └── integration/       # 集成测试
├── config/                # 配置文件目录
│   └── default.yaml       # 默认配置文件
├── docs/                  # 文档目录
│   ├── architecture.md    # 架构文档
│   ├── developer-guide.md # 开发者指南
│   ├── 安装指南.md
│   ├── 使用示例.md
│   └── 常见问题.md
├── scripts/               # 脚本目录
│   ├── install.ps1        # Windows 安装脚本
│   └── install.sh         # Linux/macOS 安装脚本
├── logs/                  # 日志目录
├── README.md              # 项目主文档
├── 中文项目说明.md        # 中文详细说明
├── 快速开始.md            # 快速上手指南
├── requirements.txt       # Python 依赖
├── CHANGELOG.md           # 更新日志
└── LICENSE                # MIT 许可证
```

## 🎯 使用场景

### 👨‍💼 系统管理员
```python
# 日常运维任务
"检查服务器CPU和内存使用情况"
"重启IIS应用程序池"
"清理临时文件和日志"
"监控磁盘空间使用"
"查看系统错误日志"
```

### 👨‍💻 开发者
```python
# 开发环境管理
"停止所有node.js进程"
"检查端口8080是否被占用"
"启动本地数据库服务"
"清理项目构建缓存"
"查看Git仓库状态"
```

### 🔒 安全专家
```python
# 安全审计任务
"显示最近登录失败的用户"
"检查防火墙规则配置"
"查看系统安全事件日志"
"监控网络连接状态"
"检查用户权限设置"
```

### 📊 数据分析师
```python
# 数据处理任务
"导出CSV格式的进程信息"
"统计日志文件中的错误数量"
"分析系统性能数据"
"生成资源使用报告"
"清理和整理数据文件"
```

## 🛠️ 开发和定制

### 添加自定义命令模板
```python
# 在 src/ai_engine/translation.py 中添加
class NaturalLanguageTranslator:
    def _load_rules(self) -> Dict[str, str]:
        """加载翻译规则"""
        return {
            # 进程管理
            r"(显示|列出|查看).*进程": "Get-Process",
            r"结束.*进程": "Stop-Process -Name {进程名}",
            
            # 服务管理
            r"(显示|查看|列出).*服务": "Get-Service",
            r"启动.*服务": "Start-Service -Name {服务名}",
            r"停止.*服务": "Stop-Service -Name {服务名}",
            
            # 自定义规则
            r"你的自定义模式": "对应的PowerShell命令",
        }
```

### 自定义安全规则
```yaml
# config/default.yaml
security:
  whitelist_mode: "strict"
  dangerous_patterns:
    - "Remove-Item.*-Recurse.*-Force"
    - "Format-Volume"
    - "你的自定义危险模式"
  
  safe_prefixes:
    - "Get-"
    - "Show-"
    - "Test-"
    - "你的自定义安全前缀"
  
  custom_rules:
    - pattern: ".*\\公司脚本\\.*"
      action: "allow"
      description: "允许执行公司批准的脚本"
    
    - pattern: "Remove-Item.*重要文件"
      action: "block"
      description: "阻止删除重要文件"
```

### 添加新的 AI 提供商
```python
# 在 src/ai_engine/providers.py 中添加
class CustomAIProvider(AIProvider):
    """自定义 AI 提供商"""
    
    def __init__(self, config):
        self.config = config
        # 初始化你的 AI 模型
    
    def generate(self, text: str, context: Context) -> Suggestion:
        """生成命令建议"""
        # 实现你的生成逻辑
        prompt = self._build_prompt(text, context)
        result = self.model.generate(prompt)
        return self._parse_result(result)
```

详细的开发指南请参考 [开发者指南](docs/developer-guide.md)

## 📈 性能优化

### AI 模型优化
```yaml
# 根据硬件配置调整
ai_model:
  # CPU 优化
  threads: 8              # CPU 线程数
  batch_size: 4           # 批处理大小
  
  # GPU 优化  
  gpu_layers: 32          # GPU 层数
  context_length: 2048    # 上下文长度
  
  # 内存优化
  temperature: 0.7        # 创造性参数
  max_tokens: 256         # 最大生成长度
```

### 系统性能监控
```python
# 性能监控示例
助手.智能对话("显示系统资源使用情况")
助手.智能对话("监控AI助手进程的CPU和内存使用")
助手.智能对话("检查磁盘I/O性能")
助手.智能对话("分析网络带宽使用")
```

## 🤝 社区和支持

### 获取帮助
- 📖 **文档**: 查看 `docs/中文文档/` 目录
- 🐛 **问题报告**: GitHub Issues
- 💬 **讨论交流**: GitHub Discussions
- 📧 **邮件支持**: support@example.com

### 贡献代码
1. Fork 项目仓库
2. 创建功能分支
3. 提交代码更改
4. 创建 Pull Request

### 社区规范
- 使用中文进行交流
- 提供详细的问题描述
- 遵循代码规范
- 尊重其他贡献者

## 📄 许可证

本项目采用 MIT 许可证，详见 [LICENSE](LICENSE) 文件。

## 🙏 致谢

感谢以下开源项目的支持：
- [FastMCP](https://github.com/jlowin/fastmcp) - MCP 协议实现
- [LLaMA.cpp](https://github.com/ggerganov/llama.cpp) - 本地 AI 模型运行
- [PowerShell](https://github.com/PowerShell/PowerShell) - 跨平台 PowerShell
- [Docker](https://www.docker.com/) - 容器化部署

---

**🚀 开始使用 AI PowerShell 智能助手，让命令行操作更加智能和高效！**
