# 🧪 在线安装脚本测试指南

## 📋 测试清单

### 1️⃣ Linux/macOS 在线安装测试

#### 基本安装测试
```bash
# 测试基本安装命令
curl -fsSL https://raw.githubusercontent.com/0green7hand0/AI-PowerShell/main/scripts/install.sh | bash

# 或者下载后执行
wget https://raw.githubusercontent.com/0green7hand0/AI-PowerShell/main/scripts/install.sh
chmod +x install.sh
./install.sh
```

#### 参数测试
```bash
# 测试帮助信息
curl -fsSL https://raw.githubusercontent.com/0green7hand0/AI-PowerShell/main/scripts/install.sh | bash -s -- --help

# 测试跳过Docker安装
curl -fsSL https://raw.githubusercontent.com/0green7hand0/AI-PowerShell/main/scripts/install.sh | bash -s -- --no-docker

# 测试开发版本安装
curl -fsSL https://raw.githubusercontent.com/0green7hand0/AI-PowerShell/main/scripts/install.sh | bash -s -- --dev
```

### 2️⃣ Windows PowerShell 在线安装测试

#### 基本安装测试
```powershell
# 测试基本安装命令
Invoke-WebRequest -Uri "https://raw.githubusercontent.com/0green7hand0/AI-PowerShell/main/scripts/install.ps1" -OutFile "install.ps1"
.\install.ps1

# 或者直接执行
Invoke-Expression (Invoke-WebRequest -Uri "https://raw.githubusercontent.com/0green7hand0/AI-PowerShell/main/scripts/install.ps1" -UseBasicParsing).Content
```

#### 参数测试
```powershell
# 测试帮助信息
.\install.ps1 -Help

# 测试跳过Docker安装
.\install.ps1 -NoDocker

# 测试自定义安装路径
.\install.ps1 -InstallPath "C:\Tools\PowerShellAssistant"

# 测试开发版本安装
.\install.ps1 -Dev
```

## 🔍 测试验证步骤

### 安装前检查
```bash
# 检查系统环境
echo "操作系统: $(uname -a)"
echo "Python版本: $(python3 --version 2>/dev/null || python --version 2>/dev/null || echo '未安装')"
echo "PowerShell版本: $(pwsh --version 2>/dev/null || echo '未安装')"
echo "Git版本: $(git --version 2>/dev/null || echo '未安装')"
echo "Docker版本: $(docker --version 2>/dev/null || echo '未安装')"
```

### 安装过程监控
```bash
# 监控安装日志
tail -f /tmp/powershell-assistant-install.log &

# 监控网络连接
netstat -an | grep :443  # HTTPS连接
netstat -an | grep :80   # HTTP连接
```

### 安装后验证
```bash
# 验证安装
powershell-assistant --version
powershell-assistant test
powershell-assistant --help

# 验证文件结构
ls -la ~/.powershell-assistant/
ls -la ~/.powershell-assistant/venv/
ls -la ~/.powershell-assistant/config/

# 验证服务启动
powershell-assistant start --test-mode
curl http://localhost:8000/health
```

## 🌐 不同环境测试

### Ubuntu 20.04/22.04
```bash
# 在Docker中测试
docker run -it ubuntu:20.04 bash
apt update && apt install -y curl
curl -fsSL https://raw.githubusercontent.com/0green7hand0/AI-PowerShell/main/scripts/install.sh | bash
```

### CentOS/RHEL 8
```bash
# 在Docker中测试
docker run -it centos:8 bash
yum install -y curl
curl -fsSL https://raw.githubusercontent.com/0green7hand0/AI-PowerShell/main/scripts/install.sh | bash
```

### macOS (通过GitHub Actions)
```yaml
# .github/workflows/test-install.yml
name: Test Installation Scripts
on: [push, pull_request]
jobs:
  test-macos:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v3
      - name: Test macOS installation
        run: |
          curl -fsSL https://raw.githubusercontent.com/0green7hand0/AI-PowerShell/main/scripts/install.sh | bash
          powershell-assistant --version
```

### Windows (多版本测试)
```powershell
# Windows 10
# Windows 11
# Windows Server 2019/2022
# PowerShell 5.1
# PowerShell Core 7.x
```

## 🚨 常见问题测试

### 网络问题模拟
```bash
# 模拟网络中断
sudo iptables -A OUTPUT -d github.com -j DROP
curl -fsSL https://raw.githubusercontent.com/0green7hand0/AI-PowerShell/main/scripts/install.sh | bash
sudo iptables -D OUTPUT -d github.com -j DROP

# 模拟DNS问题
echo "127.0.0.1 github.com" | sudo tee -a /etc/hosts
curl -fsSL https://raw.githubusercontent.com/0green7hand0/AI-PowerShell/main/scripts/install.sh | bash
sudo sed -i '/127.0.0.1 github.com/d' /etc/hosts
```

### 权限问题测试
```bash
# 非root用户测试
useradd -m testuser
su - testuser
curl -fsSL https://raw.githubusercontent.com/0green7hand0/AI-PowerShell/main/scripts/install.sh | bash

# 只读文件系统测试
mount -o remount,ro /tmp
curl -fsSL https://raw.githubusercontent.com/0green7hand0/AI-PowerShell/main/scripts/install.sh | bash
mount -o remount,rw /tmp
```

### 依赖冲突测试
```bash
# Python版本冲突
pyenv install 3.7.0
pyenv global 3.7.0
curl -fsSL https://raw.githubusercontent.com/0green7hand0/AI-PowerShell/main/scripts/install.sh | bash

# 包管理器冲突
# 同时安装多个Python包管理器
pip install --user some-conflicting-package
curl -fsSL https://raw.githubusercontent.com/0green7hand0/AI-PowerShell/main/scripts/install.sh | bash
```

## 📊 性能测试

### 安装时间测试
```bash
# 记录安装时间
time curl -fsSL https://raw.githubusercontent.com/0green7hand0/AI-PowerShell/main/scripts/install.sh | bash

# 分阶段计时
start_time=$(date +%s)
# ... 安装步骤 ...
end_time=$(date +%s)
echo "安装耗时: $((end_time - start_time)) 秒"
```

### 网络带宽测试
```bash
# 监控下载速度
iftop -i eth0 &
curl -fsSL https://raw.githubusercontent.com/0green7hand0/AI-PowerShell/main/scripts/install.sh | bash
```

### 磁盘空间测试
```bash
# 安装前后磁盘使用对比
df -h > before_install.txt
curl -fsSL https://raw.githubusercontent.com/0green7hand0/AI-PowerShell/main/scripts/install.sh | bash
df -h > after_install.txt
diff before_install.txt after_install.txt
```

## 🔧 自动化测试脚本

### 创建测试套件
```bash
#!/bin/bash
# test-installation.sh

echo "🧪 AI PowerShell Assistant 安装测试套件"
echo "========================================"

# 测试环境列表
environments=(
    "ubuntu:20.04"
    "ubuntu:22.04"
    "centos:8"
    "debian:11"
    "alpine:latest"
)

# 对每个环境进行测试
for env in "${environments[@]}"; do
    echo "测试环境: $env"
    
    docker run --rm -v $(pwd):/test $env bash -c "
        cd /test
        apt-get update -y || yum update -y || apk update
        apt-get install -y curl || yum install -y curl || apk add curl
        curl -fsSL https://raw.githubusercontent.com/0green7hand0/AI-PowerShell/main/scripts/install.sh | bash
        powershell-assistant --version
    "
    
    if [ $? -eq 0 ]; then
        echo "✅ $env 测试通过"
    else
        echo "❌ $env 测试失败"
    fi
done
```

### Windows 测试脚本
```powershell
# test-installation.ps1

Write-Host "🧪 AI PowerShell Assistant Windows 安装测试" -ForegroundColor Blue
Write-Host "=============================================="

$TestResults = @()

# 测试不同PowerShell版本
$PowerShellVersions = @(
    @{Name="PowerShell 5.1"; Command="powershell.exe"}
    @{Name="PowerShell Core"; Command="pwsh.exe"}
)

foreach ($ps in $PowerShellVersions) {
    Write-Host "测试 $($ps.Name)..." -ForegroundColor Yellow
    
    try {
        & $ps.Command -Command {
            Invoke-Expression (Invoke-WebRequest -Uri "https://raw.githubusercontent.com/0green7hand0/AI-PowerShell/main/scripts/install.ps1" -UseBasicParsing).Content
            powershell-assistant --version
        }
        
        $TestResults += @{
            Environment = $ps.Name
            Status = "通过"
            Color = "Green"
        }
    }
    catch {
        $TestResults += @{
            Environment = $ps.Name
            Status = "失败: $($_.Exception.Message)"
            Color = "Red"
        }
    }
}

# 显示测试结果
Write-Host "`n📊 测试结果汇总:" -ForegroundColor Blue
foreach ($result in $TestResults) {
    Write-Host "$($result.Environment): $($result.Status)" -ForegroundColor $result.Color
}
```

## 📈 监控和报告

### 安装成功率统计
```bash
# 创建安装统计脚本
cat > install-stats.sh << 'EOF'
#!/bin/bash
LOG_FILE="/var/log/powershell-assistant-installs.log"

# 记录安装尝试
echo "$(date): 安装开始 - IP: $REMOTE_ADDR, OS: $(uname -a)" >> $LOG_FILE

# 执行安装
if curl -fsSL https://raw.githubusercontent.com/0green7hand0/AI-PowerShell/main/scripts/install.sh | bash; then
    echo "$(date): 安装成功" >> $LOG_FILE
    exit 0
else
    echo "$(date): 安装失败" >> $LOG_FILE
    exit 1
fi
EOF
```

### 错误收集和分析
```bash
# 收集常见错误
grep "ERROR" /var/log/powershell-assistant-installs.log | sort | uniq -c | sort -nr

# 分析失败原因
awk '/安装失败/ {print $0}' /var/log/powershell-assistant-installs.log | tail -10
```

这个测试指南将帮助您全面验证在线安装脚本的可靠性和兼容性！